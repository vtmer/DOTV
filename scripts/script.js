var script = {
    stage01:{
        map:"studio",
        mapdata:[
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0]],
        add:[
             {chara:"player",img:"qd",x:12,y:17,direction:3},
             {chara:"npc",img:"man",x:12,y:8}
             ],
        talk:{
            talk1:[
                      {img:"manh",name:"维生数工作室负责人",msg:"呵呵，小伙子，欢迎来到广工大VTMER工作室，"},
                      {img:"manh",name:"维生数工作室负责人",msg:"四个种族由于长期各自为政，都形成了自己的特"},
                      {img:"manh",name:"维生数工作室负责人",msg:"色武道"},
                      {img:"qdh",name:"前端小菜鸟",msg:"都有哪些呢？"},
                      {img:"manh",name:"维生数工作室负责人",msg:"平面族擅长自然魔法元素的掌控，长久"},
                      {img:"manh",name:"维生数工作室负责人",msg:"的练习修炼让平面组寿元大增，气息雄浑。Flash"},
                      {img:"manh",name:"维生数工作室负责人",msg:"擅长机器枪械的操控，机械科技结合让flash组"},
                      {img:"manh",name:"维生数工作室负责人",msg:"攻击活力猛，强度高。前端族擅长防御之道，练到"},
                      {img:"manh",name:"维生数工作室负责人",msg:"高境界时，接近无敌的防御能力是他们无比向往的。"},
                      {img:"manh",name:"维生数工作室负责人",msg:"后台族一直崇尚上古之道，无即是有，有即是无，"},
                      {img:"manh",name:"维生数工作室负责人",msg:"长期练习气的掌控，天下武功，为快不破，气功的"},
                      {img:"manh",name:"维生数工作室负责人",msg:"使用使攻速达到了肉眼无法看到的地步让后台族十分大。"},
                      {img:"manh",name:"维生数工作室负责人",msg:"你好好想想吧，修炼哪种武道，决定了你以后的方向。"},
                      {img:"manh",name:"维生数工作室负责人",msg:"走到对应种族的能量圈后你会获得该族武道启示，"},
                      {img:"manh",name:"维生数工作室负责人",msg:"然后，你还要图书馆武道修炼之法。加油吧，骚年!"},

                  ]
        },
        jump:[
              {at:{x:11,y:18},to:"stage02"},
              {at:{x:12,y:18},to:"stage02"},
              {at:{x:13,y:18},to:"stage02"}
        ]
    },
    stage02:{
        map:"road",
        mapdata:[
            [1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [1,1,1,1,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,0,0,0],
            [1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0],
            [1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0],
            [1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],
        add:[
             {chara:"player",img:"qd",x:15,y:8},
             {chara:"npc",img:"npc1",x:8,y:3},
             {chara:"npc",img:"npc1",x:10,y:3},
             {chara:"monster",img:"nurse",x:6,y:12},
             {chara:"monster",img:"girl",x:7,y:12},
             {chara:"monster",img:"fatter",x:8,y:12}],
        talk:{
              talk1:[
                        {img:"m",name:"鸣人",msg:"你们在干什么啊？"},
                        {img:"n",name:"黑衣忍者甲",msg:"我们在喝茶。"}
                  ]
                  
        },
        jump:[
              {at:{x:17,y:7},to:"stage04"},
              {at:{x:19,y:14},to:"stage03"},
              {at:{x:0,y:9},to:"stage01"},
              {at:{x:0,y:10},to:"stage01"},
              {at:{x:0,y:11},to:"stage01"},
              {at:{x:0,y:12},to:"stage01"},
              {at:{x:0,y:13},to:"stage01"},
              {at:{x:0,y:14},to:"stage01"},
              {at:{x:0,y:15},to:"stage01"},
              {at:{x:0,y:16},to:"stage01"},
              {at:{x:0,y:17},to:"stage01"},
              {at:{x:0,y:18},to:"stage01"}
        ]
    },
    stage03:{
        map:"sb",
        mapdata:[
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
            [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],
        add:[
             {chara:"player",img:"bones",x:5,y:6},
             {chara:"npc",img:"qd",x:7,y:6},
             {chara:"npc",img:"ht",x:3,y:10},
             {chara:"npc",img:"hpm",x:3,y:10},
             {chara:"npc",img:"fl",x:3,y:9}],
        talk:{
            talk1:[
                      {img:"pmh",name:"平面",msg:"hello "},
                      {img:"qdh",name:"前端",msg:"hello world"}
                  ],
            talk2:[
                      {img:"n",name:"黑衣忍者乙",msg:"鸣人，听说忍者大战就要开始了。"},
                      {img:"m",name:"鸣人",msg:"真的吗？一定要想想办法啊。"}
                  ],
            talk3:[
                      {img:"n",name:"test",msg:"attack+100",func:function(){
                        charaLayer.childList[0].attack += 100;
                        }
                      }
                  ]
        },
        jump:[
              {at:{x:0,y:4},to:"stage02"},
              {at:{x:0,y:5},to:"stage02"}
        ]
    },
    stage04:{
        map:"lib",
        mapdata:[
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0],
            [0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0],
            [0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0],
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
            [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],
        add:[
             {chara:"player",img:"ht",x:12,y:15,direction:3},
             {chara:"npc",img:"nurse",x:12,y:6}],
        talk:{
            talk1:[
                      {img:"hth",name:"图书馆管理员",msg:"轻人，我是图书馆的掌管，你是来寻找修炼之法的吧"}
                  ]
              },
        jump:[
              //{at:{x:6,y:5},to:"stage02"}
        ]
    }
};
//根据脚本，初始化游戏画面
function initScript(){
    //地图位置初始化
    mapLayer.x = 0;
    mapLayer.y = 0;
    charaLayer.x = 0;
    charaLayer.y = 0;

    //地图层初始化
    mapLayer.removeAllChild();
    //人物层初始化
    charaLayer.removeAllChild();
    //效果层初始化
    effectLayer.removeAllChild();
    //对话层初始化
    talkLayer.removeAllChild();
    
    //地图数据获取
    map = stage.map;
    mapdata = stage.mapdata;
    //对话数据获取
    talkScriptList = stage.talk;
    //get character list
    charaList = stage.add;
    //添加地图
    addMap(0,0);
    //添加人物
    addChara();
}
//游戏场景跳转测试
function checkJump(){
    var jump = stage.jump;
    var jumpstage;
    for(var i=0;i<jump.length;i++){
        jumpstage = jump[i];
        if(player.x == jumpstage.at.x * 32 && player.y == jumpstage.at.y * 32){
            //获取该场景脚本数据
            stage = script[jumpstage.to];
            //开始跳转
            initScript(stage);
            return;
        }
    }
}